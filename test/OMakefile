if $(not $(defined-env VERBOSE))
  OMakeFlags(-S --progress)
  export

if $(or $(equal $(OSTYPE), Win32), $(equal $(OSTYPE), WindowsNT))
  CXXFLAGS += -EHsc -W3 -wd4800 -wd4819 -wd4996 -U__STRICT_ANSI__ /J $(if $(defined-env DEBUG), -Od, -O2) $(shell sdl-config --cflags) $(PLATFORMFLAGS) -I../src -D_THREAD_SAFE
  export
else
  CXXFLAGS += --ansi -U__STRICT_ANSI__ -funsigned-char $(if $(defined-env DEBUG), -g, -O2) $(shell sdl-config --cflags) $(PLATFORMFLAGS) -I../src -D_THREAD_SAFE
  export

.PHONY: clean

.SUBDIRS: NullSystem Module_Str_SEEN Module_Mem_SEEN Module_Jmp_SEEN Module_Sys_SEEN ExpressionTest_SEEN

INCLUDES += ../src
if $(or $(equal $(OSTYPE), Win32), $(equal $(OSTYPE), WindowsNT))
  LDOUT = /Fo
  LDFLAGS += /link $(if $(defined-env DEBUG), /DEBUG, /RELEASE) ../src/librlvm$(EXT_LIB) $(shell sdl-config --libs) $(PLATFORMLIBS) SDL.lib SDL_image.lib SDL_ttf.lib
  export
else
  LDFLAGS += ../src/librlvm$(EXT_LIB) $(shell sdl-config --libs)  $(shell freetype-config --libs) -lSDL_image $(PLATFORMLIBS) -lboost_filesystem -lboost_serialization -lboost_date_time  -lboost_thread
  export


TEST_FILES[] = 
  rlvmTest
  testUtils
  RLMachine_TUT
  Module_Jmp_TUT
  Module_Str_TUT
  Module_Mem_TUT
  Module_Sys_TUT
  ExpressionTest_TUT
  TextSystem_TUT
  Gameexe_TUT
  LazyArray_TUT
  GraphicsObject_TUT
  NullSystem/NullSystem
  NullSystem/NullEventSystem
  NullSystem/NullTextSystem
  NullSystem/NullTextWindow
  NullSystem/NullGraphicsSystem
  NullSystem/NullSurface
  NullSystem/MockLog

.DEFAULT: $(CXXProgram rlvmTest, $(TEST_FILES))
rlvmTest$(EXE): ../src/librlvm$(EXT_LIB) Module_Str_SEEN Module_Mem_SEEN Module_Jmp_SEEN

clean:
  $(RM) *.o *.gch *$(EXT_LIB) *.omc rlvmTest$(EXE) rlvmTest$(EXE).stackdump
