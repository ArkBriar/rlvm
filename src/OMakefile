# if $(not $(defined-env VERBOSE))
#   OMakeFlags(-S --progress)
#   export

SRCTOP = $(shell pwd)

CXXFLAGS = --ansi -Wall -U__STRICT_ANSI__ -funsigned-char -I$(SRCTOP) -I$(SRCTOP)/../vendor $(if $(defined-env DEBUG), -g, -O2) $(shell sdl-config --cflags) $(PLATFORMFLAGS) -D_THREAD_SAFE

# for testing
#CXXFLAGS += -DWIN32

.PHONY: clean
.SUBDIRS: libReallive Modules MachineBase Systems
########

LIBRLVMFILES[] = 
  MachineBase/libMachineBase
  MachineBase/GeneralOperations
  Modules/libModules
  Systems/Base/System
  Systems/Base/GraphicsSystem
  Systems/Base/GraphicsObject
  Systems/Base/GraphicsObjectData
  Systems/Base/GraphicsTextObject
  Systems/Base/ObjectSettings
  Systems/Base/FrameCounter
  Systems/Base/EventSystem
  Systems/Base/EventHandler
  Systems/Base/RLTimer
  Systems/Base/SystemError
  Systems/Base/TextWindow
  Systems/Base/TextWindowButton
  Systems/Base/TextPage
  Systems/Base/TextSystem
  Systems/Base/TextKeyCursor
  Systems/Base/GanGraphicsObjectData
  Systems/Base/AnmGraphicsObjectData
  Systems/Base/SelectionElement
  Systems/SDL/libSDLSystem
  libReallive/libReallive
  Utilities
  dateUtil
  ../vendor/libVendorLibs

# Build our precompiled headers
Precompiled.hpp.gch: Precompiled.hpp
  $(CXX) $(CXXFLAGS) -I. -x c++-header -c $< -o $@
CGeneratedFiles(Precompiled.hpp.gch)

StaticCLibrary(librlvm, $(LIBRLVMFILES))

########

LDFLAGS += librlvm$(EXT_LIB) $(shell sdl-config --libs) $(shell freetype-config --libs) -lSDL_image $(PLATFORMLIBS) -lboost_program_options -lboost_filesystem
.DEFAULT: librlvm$(EXT_LIB) $(CXXProgram rlvm, rlvm)
rlvm$(EXE): librlvm$(EXT_LIB) 

clean:
  $(RM) *.o *.gch *$(EXT_LIB) *.omc rlvm$(EXE) rlvm$(EXE).stackdump
