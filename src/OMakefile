#if $(not $(defined-env VERBOSE))
#  OMakeFlags(-S --progress)
#  export

CXXFLAGS = --ansi -U__STRICT_ANSI__ -funsigned-char $(if $(defined-env DEBUG), -g, -O2) -I/opt/local/include/ -I/opt/local/include/SDL -D_THREAD_SAFE

# for testing
#CXXFLAGS += -DWIN32

.PHONY: clean

########

LRLFILES[] =
  mmap_impl
  filemap
  compression
  expression
  bytecode
  scenario
  archive
  reference
  RLMachine
  RLModule
  RLOperation
  Module_Jmp
  Module_Sys
  Module_Str
  Module_Mem
  Module_Msg
  Module_Grp
  cp932toUnicode
  gameexe
  SDLSystem
  SDLGraphicsSystem

alldefs.h.gch: alldefs.h
  $(CXX) $(CXXFLAGS) -I. -c $< -o $@

CGeneratedFiles(alldefs.h.gch)
StaticCLibrary(libreallive, $(LRLFILES))

########

LIBS += libreallive$(EXT_LIB) -L/opt/local/lib -lSDLmain -lSDL -framework Cocoa -framework OpenGL
.DEFAULT: libreallive$(EXT_LIB) $(CXXProgram rlvm, rlvm)
rlvm$(EXE): libreallive$(EXT_LIB) 

clean:
  $(RM) *.o *.gch *$(EXT_LIB) *.omc rlvm$(EXE) rlvm$(EXE).stackdump
